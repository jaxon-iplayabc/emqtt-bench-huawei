# eMQTT-Bench å‹æµ‹ç»“æœæ˜¾ç¤ºç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

eMQTT-Bench å‹æµ‹ç»“æœæ˜¾ç¤ºç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“é—¨ä¸º eMQTT-Bench å‹æµ‹å·¥å…·è®¾è®¡çš„ç»¼åˆç›‘æ§å’Œå±•ç¤ºè§£å†³æ–¹æ¡ˆã€‚å®ƒæä¾›äº†å®æ—¶ç›‘æ§ã€Webä»ªè¡¨ç›˜å’Œè¯¦ç»†æŠ¥å‘Šç”ŸæˆåŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å…¨é¢äº†è§£å‹æµ‹è¿‡ç¨‹ä¸­çš„æ€§èƒ½è¡¨ç°ã€‚

## ğŸš€ ä¸»è¦åŠŸèƒ½

### 1. å®æ—¶ç›‘æ§æ˜¾ç¤º
- **å®æ—¶æ€§èƒ½æŒ‡æ ‡**: è¿æ¥æˆåŠŸç‡ã€æ¶ˆæ¯ååé‡ã€å»¶è¿Ÿç­‰å…³é”®æŒ‡æ ‡
- **çŠ¶æ€æŒ‡ç¤ºå™¨**: ç›´è§‚çš„é¢œè‰²ç¼–ç çŠ¶æ€æ˜¾ç¤º
- **æ€§èƒ½è¯„çº§**: è‡ªåŠ¨è®¡ç®—æ€§èƒ½è¯„åˆ†å’Œç­‰çº§
- **ä¼˜åŒ–å»ºè®®**: åŸºäºå½“å‰æ€§èƒ½æä¾›æ”¹è¿›å»ºè®®

### 2. Webä»ªè¡¨ç›˜
- **å“åº”å¼ç•Œé¢**: æ”¯æŒå¤šè®¾å¤‡è®¿é—®
- **å®æ—¶æ•°æ®æ›´æ–°**: è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæœ€æ–°æ•°æ®
- **äº¤äº’å¼å›¾è¡¨**: ç›´è§‚çš„æ•°æ®å¯è§†åŒ–
- **å†å²æ•°æ®æŸ¥çœ‹**: æ”¯æŒæŸ¥çœ‹å†å²æ€§èƒ½è¶‹åŠ¿

### 3. è¯¦ç»†æŠ¥å‘Šç”Ÿæˆ
- **æ€§èƒ½æ‘˜è¦**: å…³é”®æŒ‡æ ‡çš„ç»Ÿè®¡æ‘˜è¦
- **è¶‹åŠ¿åˆ†æ**: æ€§èƒ½å˜åŒ–è¶‹åŠ¿åˆ†æ
- **å¯¹æ¯”åˆ†æ**: ä¸å†å²æµ‹è¯•ç»“æœå¯¹æ¯”
- **ä¼˜åŒ–å»ºè®®**: åŸºäºåˆ†æç»“æœçš„æ”¹è¿›å»ºè®®

## ğŸ“Š ç›‘æ§æŒ‡æ ‡è¯´æ˜

### è¿æ¥æ€§èƒ½æŒ‡æ ‡
- **connect_succ**: æˆåŠŸå»ºç«‹çš„è¿æ¥æ•°
- **connect_fail**: è¿æ¥å¤±è´¥æ•°
- **connect_retried**: é‡è¿å°è¯•æ¬¡æ•°
- **connection_refused**: è¿æ¥è¢«æ‹’ç»æ•°
- **connection_timeout**: è¿æ¥è¶…æ—¶æ•°
- **unreachable**: ç½‘ç»œä¸å¯è¾¾é”™è¯¯æ•°

### æ¶ˆæ¯æ€§èƒ½æŒ‡æ ‡
- **pub**: å‘é€çš„æ¶ˆæ¯æ€»æ•°
- **recv**: æ¥æ”¶çš„æ¶ˆæ¯æ€»æ•°
- **pub_fail**: å‘é€å¤±è´¥çš„æ¶ˆæ¯æ•°
- **sub**: æˆåŠŸè®¢é˜…æ•°
- **sub_fail**: è®¢é˜…å¤±è´¥æ•°
- **pub_overrun**: æ¶ˆæ¯æº¢å‡ºæ•°

### å»¶è¿Ÿæ€§èƒ½æŒ‡æ ‡
- **publish_latency**: æ¶ˆæ¯å‘å¸ƒå»¶è¿Ÿ
- **mqtt_client_connect_duration**: è¿æ¥å»ºç«‹å»¶è¿Ÿ
- **mqtt_client_handshake_duration**: æ¡æ‰‹å»¶è¿Ÿ
- **e2e_latency**: ç«¯åˆ°ç«¯å»¶è¿Ÿ

## ğŸ› ï¸ å®‰è£…å’Œé…ç½®

### 1. ç¯å¢ƒè¦æ±‚
```bash
# Python 3.8+
pip install requests rich matplotlib pandas numpy
```

### 2. å¯åŠ¨ eMQTT-Bench
```bash
# å¯åŠ¨å¸¦Prometheusç›‘æ§çš„eMQTT-Bench
./emqtt_bench conn \
    -h 016bc9ac7b.st1.iotda-device.cn-north-4.myhuaweicloud.com \
    -p 1883 \
    -c 10 \
    -i 100 \
    --prefix speaker \
    -P 12345678 \
    --huawei-auth \
    --prometheus \
    --restapi 9090
```

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### 1. å®æ—¶ç›‘æ§æ¨¡å¼
```bash
# åŸºæœ¬ç”¨æ³•
python benchmark_display_system.py --mode live --test-type conn

# æŒ‡å®šç›‘æ§ç«¯å£
python benchmark_display_system.py --mode live --ports 9090 9091 9092

# è‡ªå®šä¹‰åˆ·æ–°é—´éš”
python benchmark_display_system.py --mode live --refresh-interval 2.0
```

**å®æ—¶ç›‘æ§ç•Œé¢è¯´æ˜:**
- ğŸŸ¢ ç»¿è‰²: æ€§èƒ½è‰¯å¥½
- ğŸŸ¡ é»„è‰²: æ€§èƒ½ä¸€èˆ¬ï¼Œéœ€è¦å…³æ³¨
- ğŸ”´ çº¢è‰²: æ€§èƒ½è¾ƒå·®ï¼Œéœ€è¦ä¼˜åŒ–

### 2. Webä»ªè¡¨ç›˜æ¨¡å¼
```bash
# å¯åŠ¨Webä»ªè¡¨ç›˜
python benchmark_display_system.py --mode web --web-port 8080

# è®¿é—®åœ°å€
http://localhost:8080
```

**Webä»ªè¡¨ç›˜åŠŸèƒ½:**
- è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
- å®æ—¶æ•°æ®æ›´æ–°ï¼ˆæ¯5ç§’ï¼‰
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨è®¾å¤‡
- å¤šæŒ‡æ ‡å¡ç‰‡å¼å±•ç¤º

### 3. æŠ¥å‘Šç”Ÿæˆæ¨¡å¼
```bash
# ç”ŸæˆHTMLæŠ¥å‘Š
python benchmark_display_system.py --mode report --output my_report.html

# ä½¿ç”¨é»˜è®¤æ–‡ä»¶å
python benchmark_display_system.py --mode report
```

**æŠ¥å‘Šå†…å®¹åŒ…æ‹¬:**
- æµ‹è¯•é…ç½®ä¿¡æ¯
- æ€§èƒ½æŒ‡æ ‡æ‘˜è¦
- è¶‹åŠ¿åˆ†æå›¾è¡¨
- ä¼˜åŒ–å»ºè®®

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´æ¼”ç¤ºæµç¨‹
```bash
# 1. è¿è¡Œæ¼”ç¤ºè„šæœ¬
python display_example.py

# 2. é€‰æ‹©æ¼”ç¤ºåŠŸèƒ½
# - å®æ—¶æ˜¾ç¤º
# - Webä»ªè¡¨ç›˜  
# - æŠ¥å‘Šç”Ÿæˆ
```

### è‡ªå®šä¹‰ç›‘æ§é…ç½®
```python
from benchmark_display_system import MetricsCollector, RealTimeDisplay

# åˆ›å»ºæŒ‡æ ‡æ”¶é›†å™¨
collector = MetricsCollector([9090, 9091, 9092])

# åˆ›å»ºå®æ—¶æ˜¾ç¤º
display = RealTimeDisplay(collector)

# å¯åŠ¨ç›‘æ§
display.start_live_display("conn", refresh_interval=1.0)
```

## ğŸ“ˆ æ€§èƒ½è¯„ä¼°æ ‡å‡†

### è¿æ¥æˆåŠŸç‡è¯„çº§
- **A+ (95-100%)**: ä¼˜ç§€
- **A (90-95%)**: è‰¯å¥½
- **B (80-90%)**: ä¸€èˆ¬
- **C (70-80%)**: è¾ƒå·®
- **D (<70%)**: éœ€è¦ä¼˜åŒ–

### å»¶è¿Ÿæ€§èƒ½è¯„çº§
- **ä¼˜ç§€ (<100ms)**: å»¶è¿Ÿå¾ˆä½
- **è‰¯å¥½ (100-500ms)**: å»¶è¿Ÿå¯æ¥å—
- **ä¸€èˆ¬ (500-1000ms)**: å»¶è¿Ÿè¾ƒé«˜
- **è¾ƒå·® (>1000ms)**: å»¶è¿Ÿè¿‡é«˜

### é”™è¯¯ç‡è¯„çº§
- **ä¼˜ç§€ (0%)**: æ— é”™è¯¯
- **è‰¯å¥½ (0-1%)**: é”™è¯¯ç‡å¾ˆä½
- **ä¸€èˆ¬ (1-5%)**: é”™è¯¯ç‡å¯æ¥å—
- **è¾ƒå·® (>5%)**: é”™è¯¯ç‡è¿‡é«˜

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ— æ³•è¿æ¥åˆ°Prometheusç«¯ç‚¹**
   ```
   é”™è¯¯: æ— æ³•è¿æ¥åˆ° http://localhost:9090/metrics
   è§£å†³: ç¡®ä¿eMQTT-Benchå·²å¯åŠ¨å¹¶å¯ç”¨äº†--prometheuså’Œ--restapiå‚æ•°
   ```

2. **Webä»ªè¡¨ç›˜æ— æ³•è®¿é—®**
   ```
   é”™è¯¯: ç«¯å£è¢«å ç”¨
   è§£å†³: ä½¿ç”¨--web-portå‚æ•°æŒ‡å®šå…¶ä»–ç«¯å£
   ```

3. **æŒ‡æ ‡æ•°æ®ä¸ºç©º**
   ```
   é”™è¯¯: No metrics available
   è§£å†³: ç­‰å¾…eMQTT-Benchå¯åŠ¨å®Œæˆï¼Œæˆ–æ£€æŸ¥Prometheusç«¯å£é…ç½®
   ```

### è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
python benchmark_display_system.py --mode live --verbose

# æ£€æŸ¥ç«¯å£è¿é€šæ€§
curl http://localhost:9090/metrics
```

## ğŸ“š é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰æŒ‡æ ‡é˜ˆå€¼
ä¿®æ”¹ `display_config.json` ä¸­çš„ `performance_thresholds` é…ç½®:

```json
{
  "performance_thresholds": {
    "connection_success_rate": {
      "excellent": 99,
      "good": 95,
      "warning": 80,
      "critical": 50
    }
  }
}
```

### 2. é›†æˆåˆ°CI/CD
```bash
# åœ¨CI/CDä¸­ç”ŸæˆæŠ¥å‘Š
python benchmark_display_system.py --mode report --output ci_report.html

# æ£€æŸ¥æ€§èƒ½æ˜¯å¦è¾¾æ ‡
if [ $? -eq 0 ]; then
    echo "æ€§èƒ½æµ‹è¯•é€šè¿‡"
else
    echo "æ€§èƒ½æµ‹è¯•å¤±è´¥"
    exit 1
fi
```

### 3. æ‰¹é‡æµ‹è¯•åˆ†æ
```python
# åˆ†æå¤šä¸ªæµ‹è¯•ç»“æœ
from benchmark_display_system import ReportGenerator, MetricsCollector

collector = MetricsCollector([9090])
# æ”¶é›†å¤šä¸ªæµ‹è¯•çš„æ•°æ®
for test in tests:
    collector.collect_metrics(test.type)

generator = ReportGenerator(collector)
generator.generate_report("batch_analysis.html")
```

## ğŸ¤ è´¡çŒ®å’Œæ”¯æŒ

### æŠ¥å‘Šé—®é¢˜
å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯:
- æ“ä½œç³»ç»Ÿç‰ˆæœ¬
- Pythonç‰ˆæœ¬
- eMQTT-Benchç‰ˆæœ¬
- é”™è¯¯æ—¥å¿—
- å¤ç°æ­¥éª¤

### åŠŸèƒ½å»ºè®®
æ¬¢è¿æå‡ºæ–°åŠŸèƒ½å»ºè®®ï¼ŒåŒ…æ‹¬:
- æ–°çš„ç›‘æ§æŒ‡æ ‡
- æ”¹è¿›çš„ç”¨æˆ·ç•Œé¢
- é¢å¤–çš„æŠ¥å‘Šæ ¼å¼
- æ€§èƒ½ä¼˜åŒ–å»ºè®®

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª Apache 2.0 è®¸å¯è¯ã€‚

## ğŸ‘¨â€ğŸ’» ä½œè€…

**Jaxon** - é¡¹ç›®åˆ›å»ºè€…å’Œç»´æŠ¤è€…

---

*æœ€åæ›´æ–°: 2025å¹´1æœˆ27æ—¥*

