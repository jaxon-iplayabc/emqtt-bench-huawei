# 华为云测试拆分指南

## 概述

华为云测试已成功拆分为三个独立的测试类型，以提供更全面和详细的华为云IoT平台测试覆盖。

## 拆分后的测试类型

### 1. 华为云连接测试 (Huawei Cloud Connection Test)

**目的**: 测试华为云IoT平台连接功能和设备认证
**端口**: `prometheus_port + 3` (默认9093)
**命令**: `emqtt_bench conn -h {host} -p {port} -c {client_count} -i 10 --prefix '{device_prefix}' -P '{huawei_secret}' --huawei-auth`

**功能**:
- 华为云设备认证验证
- 华为云IoT平台连接建立
- 设备ID前缀验证
- 设备密钥验证
- 连接稳定性测试

**关键指标**:
- `connect_succ`: 华为云连接成功数
- `connect_fail`: 华为云连接失败数
- `connection_idle`: 华为云空闲连接数
- `reconnect_succ`: 华为云重连成功数

**分析内容**:
- 华为云连接建立分析
- 华为云连接稳定性分析
- 华为云认证验证分析
- 华为云连接测试结论

---

### 2. 华为云发布测试 (Huawei Cloud Publish Test)

**目的**: 测试华为云IoT平台消息发布功能和设备属性上报
**端口**: `prometheus_port + 4` (默认9094)
**命令**: `emqtt_bench pub -h {host} -p {port} -c {client_count} -i 10 -I {msg_interval} -t '$oc/devices/%d/sys/properties/report' --prefix '{device_prefix}' -P '{huawei_secret}' --huawei-auth --message 'template://{template_path}'`

**功能**:
- 华为云设备属性上报
- 华为云标准消息格式验证
- 华为云模板消息发布
- 华为云发布性能测试
- 华为云消息格式兼容性验证

**关键指标**:
- `pub_succ`: 华为云发布成功数
- `pub_fail`: 华为云发布失败数
- `pub`: 华为云总发布数
- `pub_overrun`: 华为云发布溢出数
- `publish_latency`: 华为云发布延迟

**分析内容**:
- 华为云发布吞吐量分析
- 华为云发布延迟分析
- 华为云消息格式验证分析
- 华为云发布可靠性分析
- 华为云发布测试结论

---

### 3. 华为云订阅测试 (Huawei Cloud Subscribe Test)

**目的**: 测试华为云IoT平台消息订阅功能和设备命令接收
**端口**: `prometheus_port + 5` (默认9095)
**命令**: `emqtt_bench sub -h {host} -p {port} -c {client_count} -i 10 -t '$oc/devices/%d/sys/commands/#' --prefix '{device_prefix}' -P '{huawei_secret}' --huawei-auth`

**功能**:
- 华为云设备命令订阅
- 华为云命令接收处理
- 华为云订阅性能测试
- 华为云命令响应能力测试
- 华为云订阅稳定性验证

**关键指标**:
- `sub_succ`: 华为云订阅成功数
- `sub_fail`: 华为云订阅失败数
- `recv`: 华为云接收消息数
- `sub_overrun`: 华为云订阅溢出数

**分析内容**:
- 华为云订阅性能分析
- 华为云消息接收分析
- 华为云命令处理分析
- 华为云订阅测试结论

---

## 华为云特殊配置

### 认证配置
- **认证方式**: 华为云设备认证 (`--huawei-auth`)
- **设备前缀**: 华为云设备ID前缀 (`--prefix`)
- **设备密钥**: 华为云设备密钥 (`-P`)

### 主题配置
- **发布主题**: `$oc/devices/%d/sys/properties/report` (设备属性上报)
- **订阅主题**: `$oc/devices/%d/sys/commands/#` (设备命令接收)

### 消息模板
使用华为云设备属性上报模板 (`huawei_cloud_payload_template.json`)，包含：
- 播放状态数据
- 电池状态数据
- 存储状态数据
- 设置参数数据
- WiFi状态数据

## 端口分配

| 测试类型 | 端口 | 描述 |
|---------|------|------|
| 连接测试 | 9090 | 标准MQTT连接测试 |
| 发布测试 | 9091 | 标准MQTT发布测试 |
| 订阅测试 | 9092 | 标准MQTT订阅测试 |
| 华为云连接测试 | 9093 | 华为云连接测试 |
| 华为云发布测试 | 9094 | 华为云发布测试 |
| 华为云订阅测试 | 9095 | 华为云订阅测试 |

## 测试执行流程

1. **连接测试**: 验证华为云IoT平台连接和认证
2. **发布测试**: 验证华为云设备属性上报功能
3. **订阅测试**: 验证华为云设备命令接收功能

## 分析报告结构

### 华为云连接测试深度分析
- 华为云连接建立分析
- 华为云连接稳定性分析
- 华为云认证验证分析
- 华为云连接测试结论

### 华为云发布测试深度分析
- 华为云发布吞吐量分析
- 华为云发布延迟分析
- 华为云消息格式验证分析
- 华为云发布可靠性分析
- 华为云发布测试结论

### 华为云订阅测试深度分析
- 华为云订阅性能分析
- 华为云消息接收分析
- 华为云命令处理分析
- 华为云订阅测试结论

## 优势

1. **更全面的测试覆盖**: 分别测试连接、发布、订阅功能
2. **更详细的分析**: 每个测试都有专门的分析逻辑
3. **更好的问题定位**: 可以精确定位华为云集成中的问题
4. **更专业的报告**: 针对华为云IoT平台的专业分析

## 使用说明

1. 确保华为云认证配置正确
2. 选择要运行的华为云测试类型
3. 查看对应的分析报告
4. 根据分析结果优化华为云集成配置

---

*本指南说明了华为云测试拆分的详细实现和使用方法。*
